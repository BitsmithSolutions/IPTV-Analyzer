
= DB changes between version =

Document the DB changes between versions

== From: 0.9.0 to 0.9.1 ===

To apply changes described below run:

  cd database/
  mysql -u root -p tvprobe < database-upgrade-0.9.0-to-0.9.1.sql

Need to support packet and byte counters (named "packets" and
"payload_bytes").  The column "packets" already exist, and the column
"bytes" need to be renamed to "payload_bytes".

  ALTER TABLE log_event
  	CHANGE `bytes` `payload_bytes` BIGINT(20) unsigned default '0';

Also store the delta for payload_bytes and packets.  This can be
easily used for calculation a number of things, e.g. bandwidth
combined with delta time since last record (delta_poll is not usable
for this purpose), if TS mapping 7 is used or not.

  ALTER TABLE log_event
   ADD `delta_payload_bytes` int(10) unsigned NOT NULL default '0',
   ADD `delta_packets`       int(10) unsigned NOT NULL default '0';

To relate the delta counters, to something, we need to know when the
last record were updated, so we can determine the seconds these delta
counters account for.  This way is possible to calculate bandwidth and
packets per sec.

Add a "last_update" timestamp and a "delta_update" time:

  ALTER TABLE log_event
   ADD last_update   timestamp NOT NULL default '0000-00-00 00:00:00',
   ADD delta_update  float unsigned default NULL;

Change "delta_poll" to use type "float" instead of "int(11)"
(eventhough the precision of "delta_poll" is not as important as
"delta_update").

  ALTER TABLE log_event
   MODIFY delta_poll float unsigned default NULL;


=== Event types ===

Introducing new event types in this version.

* New event type: "no-signal" detection.
* New event type: "heartbeat".

Need a side table describing the event types, as there previously were
only one event type (drops).

Event datatype, design discussion: We also need to consider that,
potentially/theoretically, is possible for two events type to occur in
the same poll cycle.  Thus, either we need some kind of bit-vector so
several events can be recorded together, or else the software needs to
record two log_event records.  Its possible to use the MySQL
"SET-type", to create a SQL bit-vector.  The problem with this
approach is, that each time a new event type is created, the database
needs to be altered.

Future event types, could be related to burst, jitter, PCR-clock issues.
